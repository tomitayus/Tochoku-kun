# å½“ç›´ãã‚“ - åŒ»å¸«å½“ç›´ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 

Google Colabç‰ˆã‚’Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŒ–ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸ“‹ æ¦‚è¦

åŒ»å¸«ã®å½“ç›´ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã€è¤‡æ•°ã®åˆ¶ç´„æ¡ä»¶ã‚’è€ƒæ…®ã—ã¦è‡ªå‹•ç”Ÿæˆã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- âœ… è¤‡æ•°ã®åˆ¶ç´„ã‚’è€ƒæ…®ã—ãŸè‡ªå‹•å‰²å½“ï¼ˆå¯å¦ã€ã‚«ãƒ†è¡¨ã€gapã€capç­‰ï¼‰
- âœ… Greedy + å±€æ‰€æ¢ç´¢ã«ã‚ˆã‚‹æœ€é©åŒ–
- âœ… è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆï¼ˆ100ã€œ10000ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- âœ… TOP3ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‡ºåŠ›
- âœ… è¨ºæ–­æƒ…å ±ã®è‡ªå‹•ç”Ÿæˆï¼ˆgapé•åã€é‡è¤‡ã€åã‚Šç­‰ï¼‰
- âœ… å‰æœˆç´¯ç©ãƒ‡ãƒ¼ã‚¿ã®è€ƒæ…®

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚  HTTP   â”‚   FastAPI    â”‚         â”‚  Scheduler  â”‚
â”‚  (HTML/JS)  â”‚ â”€â”€â”€â”€â”€â”€> â”‚   Backend    â”‚ â”€â”€â”€â”€â”€â”€> â”‚   Logic     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              v
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ pandas/numpy â”‚
                        â”‚   openpyxl   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
duty-roster-scheduler/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app.py              # FastAPI ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ scheduler.py        # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆâ€»è¦å®Œæˆï¼‰
â”‚   â””â”€â”€ requirements.txt    # Pythonä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ index.html          # Webã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ BUGS_AND_ISSUES.md  # ãƒã‚°ãƒ»å•é¡Œç‚¹ã®ä¸€è¦§
â”‚   â””â”€â”€ WEB_MIGRATION_PLAN.md  # WebåŒ–ã®è©³ç´°è¨­è¨ˆ
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å¿…è¦ç’°å¢ƒ

- Python 3.10ä»¥ä¸Š
- ç¾ä»£çš„ãªWebãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆChrome, Firefox, Safari, Edgeç­‰ï¼‰

### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd backend

# ä»®æƒ³ç’°å¢ƒä½œæˆ
python -m venv venv

# ä»®æƒ³ç’°å¢ƒã®æœ‰åŠ¹åŒ–
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®èµ·å‹•

åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ï¼š

```bash
cd frontend

# ç°¡æ˜“HTTPã‚µãƒ¼ãƒãƒ¼èµ·å‹•
# Python 3ã®å ´åˆ
python -m http.server 8080

# ã¾ãŸã¯ã€VSCodeã®Live Serveræ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨
```

### 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹

```
http://localhost:8080
```

## ğŸ“ ä½¿ã„æ–¹

1. **Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™**
   - sheet1: ã‚·ãƒ•ãƒˆè¡¨ï¼ˆæ—¥ä»˜ + ç—…é™¢åˆ—ï¼‰
   - sheet2: åŒ»å¸«ã®å¯å¦ï¼ˆ0=ä¸å¯, 1=å¯, 2=Bã€œMã®ã¿, 3=Hã€œUã®ã¿ï¼‰
   - sheet3: ã‚«ãƒ†è¡¨
   - sheet4: å‰æœˆã¾ã§ã®ç´¯ç©ãƒ‡ãƒ¼ã‚¿

2. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
   - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ

3. **è¨­å®šã‚’èª¿æ•´**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°: 100ã€œ10000ï¼ˆæ¨å¥¨: 1000ï¼‰
   - å±€æ‰€æ¢ç´¢: æœ‰åŠ¹æ¨å¥¨
   - ç¥æ—¥: YYYY-MM-DDå½¢å¼ã§å…¥åŠ›
   - æ°´æ›œç¦æ­¢åŒ»å¸«: ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›

4. **ç”Ÿæˆé–‹å§‹**
   - ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   - é€²æ—ãƒãƒ¼ã§å‡¦ç†çŠ¶æ³ã‚’ç¢ºèª

5. **çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**
   - å®Œäº†å¾Œã€Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - TOP3ãƒ‘ã‚¿ãƒ¼ãƒ³ + è¨ºæ–­ã‚·ãƒ¼ãƒˆãŒå«ã¾ã‚Œã¾ã™

## ğŸ› æ—¢çŸ¥ã®å•é¡Œ

è©³ç´°ã¯ [BUGS_AND_ISSUES.md](docs/BUGS_AND_ISSUES.md) ã‚’å‚ç…§

### ä¸»ãªæœªä¿®æ­£ãƒã‚°

1. **scheduler.py ãŒæœªå®Œæˆ**
   - ç¾åœ¨ã€ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿éƒ¨åˆ†ã®ã¿å®Ÿè£…
   - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆgreedy + local searchï¼‰ã¯å…ƒã®Colabã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç§»æ¤ãŒå¿…è¦

2. **åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**
   - Bã€œUåˆ—ã®æƒ³å®šãŒå›ºå®šçš„
   - åˆ—åã‹ã‚‰å‹•çš„ã«å–å¾—ã™ã‚‹å¿…è¦ã‚ã‚Š

3. **åŒ»å¸«åã®æ­£è¦åŒ–ä¸è¶³**
   - å…¨è§’/åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ¶ç´„ãŒåŠ¹ã‹ãªã„å¯èƒ½æ€§

### å›é¿ç­–

- ç¾æ™‚ç‚¹ã§ã¯ **ã‚ªãƒªã‚¸ãƒŠãƒ«ã®Colabç‰ˆ** ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨
- Webç‰ˆã¯é–‹ç™ºä¸­ï¼ˆscheduler.pyã®ç§»æ¤ãŒå¿…è¦ï¼‰

## ğŸ”§ é–‹ç™ºã‚¬ã‚¤ãƒ‰

### scheduler.pyã®å®Œæˆæ–¹æ³•

å…ƒã®Colabã‚³ãƒ¼ãƒ‰ã‹ã‚‰ä»¥ä¸‹ã®é–¢æ•°ã‚’ç§»æ¤ï¼š

1. `build_schedule_pattern()` - greedyå‰²å½“
2. `local_search_swap()` - å±€æ‰€æ¢ç´¢
3. `evaluate_schedule_with_raw()` - ã‚¹ã‚³ã‚¢è¨ˆç®—
4. `build_summaries()` - ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
5. `build_diagnostics()` - è¨ºæ–­æƒ…å ±ç”Ÿæˆ

**ç§»æ¤æ™‚ã®æ³¨æ„ç‚¹**:
- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ `self.XXX` ã«å¤‰æ›´
- `files.upload()` / `files.download()` ã®å‰Šé™¤
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®è¿½åŠ 
- å‹ãƒ’ãƒ³ãƒˆã®è¿½åŠ 

### ãƒ†ã‚¹ãƒˆæ–¹æ³•

```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
pytest tests/test_scheduler.py

# ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
pytest --cov=backend tests/
```

## ğŸ“Š APIä»•æ§˜

### POST /api/schedule/generate

ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”Ÿæˆã‚’é–‹å§‹

**Request**:
- `file`: Excelãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆmultipart/form-dataï¼‰
- `config`: è¨­å®šï¼ˆJSONæ–‡å­—åˆ—ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**Response**:
```json
{
  "task_id": "uuid-xxxx",
  "status": "processing",
  "progress": 0
}
```

### GET /api/schedule/status/{task_id}

ã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—

**Response**:
```json
{
  "task_id": "uuid-xxxx",
  "status": "completed",
  "progress": 100,
  "result_url": "/api/schedule/download/uuid-xxxx"
}
```

### GET /api/schedule/download/{task_id}

çµæœã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

**Response**: Excelãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆbinaryï¼‰

## ğŸš¢ ãƒ‡ãƒ—ãƒ­ã‚¤

### Dockerã‚’ä½¿ç”¨

```bash
# ãƒ“ãƒ«ãƒ‰
docker build -t duty-scheduler backend/

# å®Ÿè¡Œ
docker run -p 8000:8000 duty-scheduler
```

### Render.comï¼ˆæ¨å¥¨ï¼‰

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã« push
2. Render.com ã§Web Serviceã‚’ä½œæˆ
3. Build Command: `pip install -r requirements.txt`
4. Start Command: `uvicorn app:app --host 0.0.0.0 --port $PORT`

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆé™çš„ã‚µã‚¤ãƒˆï¼‰

- Netlify / Vercel / GitHub Pages ã§å…¬é–‹
- `index.html` ã® `API_BASE` ã‚’æœ¬ç•ªURLã«å¤‰æ›´

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### æœ¬ç•ªç’°å¢ƒã§ã®æ³¨æ„ç‚¹

1. **CORSè¨­å®šã‚’åˆ¶é™**
   ```python
   allow_origins=["https://yourdomain.com"]
   ```

2. **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™**
   - ç¾åœ¨: 10MB
   - å¿…è¦ã«å¿œã˜ã¦èª¿æ•´

3. **ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚’Redis/DBã«å¤‰æ›´**
   - ç¾åœ¨ã¯ãƒ¡ãƒ¢ãƒªä¸Šï¼ˆå†èµ·å‹•ã§æ¶ˆãˆã‚‹ï¼‰

4. **èªè¨¼ãƒ»èªå¯ã®è¿½åŠ **
   - ç¾åœ¨ã¯æœªå®Ÿè£…
   - OAuth2 / JWT ã®æ¤œè¨

## ğŸ“š å‚è€ƒè³‡æ–™

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [pandas Documentation](https://pandas.pydata.org/docs/)
- [openpyxl Documentation](https://openpyxl.readthedocs.io/)

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿œã˜ã¦è¨­å®šï¼‰

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“§ ãŠå•ã„åˆã‚ã›

ï¼ˆé€£çµ¡å…ˆã‚’è¨˜è¼‰ï¼‰

---

**æ³¨æ„**: ç¾åœ¨ã€`scheduler.py` ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã¯æœªå®Ÿè£…ã§ã™ã€‚
æœ¬ç•ªåˆ©ç”¨å‰ã«ã€å…ƒã®Colabã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã®ç§»æ¤ãŒå¿…è¦ã§ã™ã€‚
